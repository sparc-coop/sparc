@using System.Globalization

@page "/blogs/{slug}"

<article class="blog-post">
    <header>
        <h1 data-tag="Title" class="@(IsPlaceholder("Title") ? "placeholder" : "")">
            @GetTag("Title")  
        </h1>

        <aside data-tag="Author" class="@(IsPlaceholder("Author") ? "placeholder" : "")">
            @GetTag("Author")
        </aside>

        <time datetime="@(DateTime.Now.ToString("O"))">
            @* @DateTime.Now.ToString("MMMM d, yyyy") *@
            @CultureInfo.CurrentCulture.TextInfo.ToTitleCase(DateTime.Now.ToString("MMMM d, yyyy"))
        </time>
    </header>

    <figure>
        <img data-tag="ImageUrl" src="@GetTag("ImageUrl")" alt="@GetTag("Title")" class="@(IsPlaceholder("ImageUrl") ? "placeholder" : "")" />
    </figure>

    <section class="content">
        <p data-tag="Content" class="@(IsPlaceholder("Content") ? "placeholder" : "")">
            @GetTag("Content")
        </p>
    </section>
</article>

@code {
    [Parameter] public string? Slug { get; set; }

    private Kori.TagManager B { get; } = new Kori.TagManager();

    private Dictionary<string, string> DefaultValues;

    protected override void OnInitialized()
    {
        DefaultValues = new Dictionary<string, string>
        {
            { "Title", "Type your title here" },
            { "Author", "Author Name" },
            { "ImageUrl", $"data:image/svg+xml;base64,{ConvertToBase64Image()}" },
            { "Content", "Type blog post content here." }
        };

        foreach (var key in DefaultValues.Keys)
        {
            B[key] = DefaultValues[key];
        }
    }

    private string GetTag(string key)
    {
        return B[key];        
    }    

    private bool IsPlaceholder(string key)
    {
        return B[key] == DefaultValues[key];
    }

    private static string ConvertToBase64Image()
    {
        string svg = @"
            <svg xmlns='http://www.w3.org/2000/svg' width='600' height='400'>
                <rect width='100%' height='100%' fill='#f2f2f2' />
                <text x='50%' y='50%' alignment-baseline='middle' text-anchor='middle' fill='#888' font-family='Arial, sans-serif' font-size='24'>
                    Upload your image here
                </text>
            </svg>";

        return Convert.ToBase64String(System.Text.Encoding.UTF8.GetBytes(svg));
    }  
}